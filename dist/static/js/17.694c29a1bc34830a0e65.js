webpackJsonp([17],{"+6A7":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("gBtx"),l=a.n(i),s=a("mvHQ"),o=a.n(s),n={name:"ETLCaseDialog",props:{caseId:{type:Number,default:null},type:{type:Number,default:1},visible:{type:Boolean,default:!0}},data:function(){return{caseTypeOptions:[{label:"事件",value:1},{label:"用户属性",value:2}],dialogVisible:!1,caseDetail:{id:"",caseName:"",caseType:"",param:""},rules:{caseName:[{required:!0,message:"用例名称不能为空"}],caseType:[{required:!0,message:"用例类型不能为空"}],param:[{required:!0,message:"上报参数不能为空"}]}}},methods:{close:function(){this.$emit("listenToChildEvent",!1)},saveCase:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var a=String.format("{0}/etlCase/add",t.GLOBAL.ETL_URL);t.axios.post(a,t.caseDetail,{headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){return console.log(e.data.code),"1000"===e.data.code?(t.Message.success(e.data.message),t.dialogVisible=!1,t.$emit("listenToChildEvent",!0)):t.Message.error(e.data.message),e}).catch(function(e){return e})}})},detail:function(){var e=this,t=String.format("{0}/etlCase/detail?id={1}",this.GLOBAL.ETL_URL,this.caseId);this.axios.get(t).then(function(t){return e.caseDetail=t.data.data,t}).catch(function(e){return e})}},computed:{dialogTitle:function(){return 2===this.type?"编辑（用例ID："+this.caseId+"）":3===this.type?"复制":"新增"},btnText:function(){return 3===this.type?"复 制":"保 存"},typeText:function(){return 2===this.type?"编辑":3===this.type?"复制":"新增"}},created:function(){this.dialogVisible=this.visible,2!==this.type&&3!==this.type||this.detail()}},r={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"case-dialog",attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"80%"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close}},[a("div",[a("el-card",{staticClass:"box-card"},[a("el-form",{ref:"caseDetail",attrs:{inline:!0,model:e.caseDetail,size:"mini",rules:e.rules}},[a("el-row",{attrs:{gutter:20}},[a("el-form-item",{attrs:{label:"用例名称",prop:"caseName"}},[a("el-col",{attrs:{span:12}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"必填项",clearable:""},model:{value:e.caseDetail.caseName,callback:function(t){e.$set(e.caseDetail,"caseName",t)},expression:"caseDetail.caseName"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"用例类型",prop:"caseType"}},[a("el-col",{attrs:{span:12}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择",clearable:""},model:{value:e.caseDetail.caseType,callback:function(t){e.$set(e.caseDetail,"caseType",t)},expression:"caseDetail.caseType"}},e._l(e.caseTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-form-item",{staticStyle:{float:"left"},attrs:{label:"上报参数",prop:"param"}},[a("el-col",{attrs:{span:12}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:8},placeholder:"必填项:请输入内容",clearable:""},model:{value:e.caseDetail.param,callback:function(t){e.$set(e.caseDetail,"param",t)},expression:"caseDetail.param"}})],1)],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:e.close}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.saveCase("caseDetail")}}},[e._v("\n      "+e._s(e.btnText)+"\n    ")])],1)])},staticRenderFns:[]};var c={name:"ETLCaseList",components:{etlCaseDialog:a("VU/8")(n,r,!1,function(e){a("HtWW")},"data-v-8f55620c",null).exports},data:function(){return{loading:!1,allCaseList:[],executeDialog:!1,configDetail:{url:"http://39.100.208.209:8991/sync_json",valueMap:'{"appid":"69b2de81e39d4528a06f62cccf280af5","data.#time":"'+this.getNowTime()+'"}',idList:[],version:"4.0",subVersion:"4.0.1",trinoMap:'{"url": "jdbc:trino://39.100.208.209:8080","user": "ta","password": "","SSL": "false"}',projectId:"3800",time:this.getCurrentDate(),customCheck:!1,sqlList:"select count(*) as count1 FROM hive.ta.\"v_user_3800\" t where batchNo='%s' and uuid not in (%s),\n select count(*) as count2 FROM hive.ta.\"v_event_3800\" t where batchNo='%s' and uuid not in (%s)",expectValueList:'[[{"count":1}],[{"count2":2}]]',waitTime:5},configRules:{url:[{required:!0,message:"上报地址不能为空"}],idList:[{required:!0,message:"用例列表不能为空"}],trinoMap:[{required:!0,message:"trino配置不能为空"}],projectId:[{required:!0,message:"项目ID不能为空"}],time:[{required:!0,message:"上报日期不能为空"}],waitTime:[{required:!0,message:"等待时长不能为空"}],customCheck:[{required:!0,message:"校验方式不能为空"}]},caseTypeOptions:[{label:"事件",value:1},{label:"用户属性",value:2}],verifyTypeOptions:[{label:"默认校验",value:!1},{label:"自定义校验",value:!0}],pageSize:10,total:0,pageNum:1,caseId:null,dialogVisibleType:1,dialogVisible:!1,searchForm:{id:"",caseName:"",caseType:null,addTime:"",updateTime:""},tableData:[]}},methods:{getNowTime:function(){var e=new Date;return e.getFullYear()+"-"+(e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-"+(e.getDate()<10?"0"+e.getDate():e.getDate())+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds())+"."+e.getMilliseconds()},getCurrentDate:function(){var e=new Date,t={year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate()};return t.year+"-"+(t.month>=10?t.month:"0"+t.month)+"-"+(t.date>=10?t.date:"0"+t.date)},tableRowClassName:function(e){e.row;return e.rowIndex%2==0?"warning-row":"success-row"},callbackFunc:function(e){this.dialogVisible=!1,e&&this.getCaseList("search")},reSet:function(){this.pageNum=1,this.searchForm={id:"",caseName:"",caseType:"",addTime:"",updateTime:""},this.getCaseList("search")},caseDetail:function(e,t){"edit"===t?this.dialogVisibleType=2:"copy"===t&&(this.dialogVisibleType=3),this.caseId=e,this.dialogVisible=!0},getCaseList:function(e){var t=this;"search"===e&&(this.pageNum=1);var a=String.format("{0}/etlCase/list",this.GLOBAL.ETL_URL);this.searchForm.pageNum=this.pageNum,this.axios.post(a,this.searchForm,{headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){return t.total=e.data.data.total,t.tableData=e.data.data.apiEtlCaseList,e}).catch(function(e){return e})},deleteCase:function(e){var t=this;this.$confirm(String.format("此操作将永久删除该用例(id:{0}), 是否继续?",e),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a=String.format("{0}/etlCase/delete",t.GLOBAL.ETL_URL),i={id:e};t.axios.post(a,i,{headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){return"1000"===e.data.code?(t.Message.success(e.data.message),t.getCaseList("search")):t.Message.error(e.data.message),e}).catch(function(e){return e})})},openExecuteDialog:function(){var e=JSON.parse(localStorage.getItem("executeCaseConfig"));null!==e&&(this.configDetail=e),this.executeDialog=!0},closeExecuteDialog:function(){this.executeDialog=!1,this.configDetail={url:"http://39.100.208.209:8991/sync_json",valueMap:'{"appid":"69b2de81e39d4528a06f62cccf280af5","data.#time":"'+this.getNowTime()+'"}',idList:[],version:"4.0",subVersion:"4.0.1",trinoMap:'{"url": "jdbc:trino://39.100.208.209:8080","user": "ta","password": "","SSL": "false"}',projectId:"3800",time:this.getCurrentDate(),customCheck:!1,sqlList:"select count(*) as count1 FROM hive.ta.\"v_user_3800\" t where batchNo='%s' and uuid not in (%s),\n select count(*) as count2 FROM hive.ta.\"v_event_3800\" t where batchNo='%s' and uuid not in (%s)",expectValueList:'[[{"count":1}],[{"count2":2}]]',waitTime:5}},saveConfig:function(){localStorage.setItem("executeCaseConfig",o()(this.configDetail)),this.Message.success("保存成功")},executeCase:function(e){var t=this;this.loading=!0;var a=localStorage.getItem("executeCaseConfig"),i=JSON.parse(a),s=String.format("{0}/etlCase/execute",this.GLOBAL.ETL_URL);i.sqlList=i.sqlList.replace("\n","").split(","),i.expectValueList=JSON.parse(i.expectValueList),i.idList=[e],i.valueMap=JSON.parse(i.valueMap),i.trinoMap=JSON.parse(i.trinoMap),i.waitTime=l()(i.waitTime),this.axios.post(s,i,{headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){return t.loading=!1,"1000"===e.data.code?t.Message.success(e.data.message):t.Message.error(e.data.message),e}).catch(function(e){return e})},clickAddBtn:function(){this.dialogVisibleType=1,this.dialogVisible=!0}},beforeMount:function(){this.getCaseList(),null===localStorage.getItem("executeCaseConfig")&&localStorage.setItem("executeCaseConfig",o()(this.configDetail))}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{"margin-top":"10px"},attrs:{shadow:"always","element-loading-text":"执行中,上报后会等待10秒,请稍等～～～～～","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[a("el-form",{attrs:{inline:!0,model:e.searchForm,size:"mini"}},[a("el-form-item",{attrs:{label:"用例id"}},[a("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"输入用例id",clearable:""},model:{value:e.searchForm.id,callback:function(t){e.$set(e.searchForm,"id",t)},expression:"searchForm.id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"用例名称"}},[a("el-input",{attrs:{placeholder:"输入用例名称",clearable:""},model:{value:e.searchForm.caseName,callback:function(t){e.$set(e.searchForm,"caseName",t)},expression:"searchForm.caseName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"用例类型"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择",clearable:""},model:{value:e.searchForm.caseType,callback:function(t){e.$set(e.searchForm,"caseType",t)},expression:"searchForm.caseType"}},e._l(e.caseTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"创建时间"}},[a("el-date-picker",{staticStyle:{width:"360px"},attrs:{type:"datetimerange",align:"right","start-placeholder":"起始时间","end-placeholder":"截止时间","default-time":["00:00:00","23:59:59"],"value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.searchForm.addTime,callback:function(t){e.$set(e.searchForm,"addTime",t)},expression:"searchForm.addTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"更新时间"}},[a("el-date-picker",{staticStyle:{width:"360px"},attrs:{type:"datetimerange",align:"right","start-placeholder":"起始时间","end-placeholder":"截止时间","default-time":["00:00:00","23:59:59"],"value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.searchForm.updateTime,callback:function(t){e.$set(e.searchForm,"updateTime",t)},expression:"searchForm.updateTime"}})],1),e._v(" "),a("el-form-item",{staticStyle:{float:"right","margin-right":"60px"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getCaseList("search")}}},[e._v("查 询\n        ")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:e.clickAddBtn}},[e._v("新 增")]),e._v(" "),a("el-button",{attrs:{type:"info"},on:{click:e.reSet}},[e._v("重 置")]),e._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:e.openExecuteDialog}},[e._v("执行配置\n        ")])],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"",size:"mini","row-class-name":e.tableRowClassName,align:"center"}},[a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"id",label:"用例id",width:"100",align:"center",fixed:"left"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"caseName",label:"用例名称",width:"250",align:"center"}}),e._v(" "),a("el-table-column",{attrs:{"show-overflow-tooltip":"",prop:"caseType",label:"用例类型",align:"center",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===e.tableData[t.$index].caseType?a("span",[e._v("事件")]):2===e.tableData[t.$index].caseType?a("span",[e._v("用户属性")]):a("span",[e._v("未知")])]}}])}),e._v(" "),a("el-table-column",{attrs:{align:"center","show-overflow-tooltip":"",prop:"param",label:"上报参数",width:"400"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","show-overflow-tooltip":"",prop:"addTime",label:"创建时间",width:"250"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","show-overflow-tooltip":"",prop:"addTime",label:"更新时间",width:"250"}}),e._v(" "),a("el-table-column",{attrs:{align:"center","show-overflow-tooltip":"",label:"操作",width:"250",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.executeCase(e.tableData[t.$index].id)}}},[e._v("执行\n          ")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.caseDetail(e.tableData[t.$index].id,"copy")}}},[e._v("复制\n          ")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.caseDetail(e.tableData[t.$index].id,"edit")}}},[e._v("编辑\n          ")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.deleteCase(e.tableData[t.$index].id)}}},[e._v("删除\n          ")])]}}])})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{"current-page":e.pageNum,"page-size":e.pageSize,layout:"total,slot, prev, pager, next, jumper",total:e.total,size:"mini"},on:{"current-change":function(t){return e.getCaseList()},"update:currentPage":function(t){e.pageNum=t},"update:current-page":function(t){e.pageNum=t}}},[a("span",[e._v(e._s(e.pageSize)+"条/页")])])],1),e._v(" "),e.dialogVisible?a("etl-case-dialog",{attrs:{visible:e.dialogVisible,"case-id":e.caseId,type:e.dialogVisibleType},on:{listenToChildEvent:e.callbackFunc}}):e._e(),e._v(" "),a("el-dialog",{attrs:{title:"执行配置",visible:e.executeDialog,width:"78%"},on:{"update:visible":function(t){e.executeDialog=t},close:e.closeExecuteDialog}},[a("div",[a("el-card",{staticClass:"box-card"},[a("el-form",{ref:"configDetail",attrs:{inline:!0,model:e.configDetail,size:"mini",rules:e.configRules}},[a("el-row",{attrs:{gutter:20}},[a("el-form-item",{attrs:{label:"上报地址",prop:"url"}},[a("el-col",{attrs:{span:12}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:8},placeholder:"必填项:http://39.100.208.209:8991/sync_json",clearable:""},model:{value:e.configDetail.url,callback:function(t){e.$set(e.configDetail,"url",t)},expression:"configDetail.url"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"动态参数                                                                ",prop:"valueMap"}},[a("el-col",{attrs:{span:12}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:8},placeholder:'请输入内容:{"data.#time":"2023-04-26 00:00:00.567","#event_name":"测试事件名称","properties.batchNo":"2023-04-26 00:00:00"}',clearable:""},model:{value:e.configDetail.valueMap,callback:function(t){e.$set(e.configDetail,"valueMap",t)},expression:"configDetail.valueMap"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-form-item",{attrs:{label:"trino配置",prop:"trinoMap"}},[a("el-col",{attrs:{span:12}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:8},placeholder:'必填项:{"url":"jdbc:trino://192.168.0.106:8080","user":"ta","password":"","SSL":"false"}',clearable:""},model:{value:e.configDetail.trinoMap,callback:function(t){e.$set(e.configDetail,"trinoMap",t)},expression:"configDetail.trinoMap"}})],1)],1),e._v(" "),a("el-form-item",{staticClass:"verifyForm",attrs:{label:"校验方式",prop:"customCheck"}},[a("el-col",{attrs:{span:6}},[a("el-select",{staticClass:"verifySelect",attrs:{placeholder:"请选择"},model:{value:e.configDetail.customCheck,callback:function(t){e.$set(e.configDetail,"customCheck",t)},expression:"configDetail.customCheck"}},e._l(e.verifyTypeOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"等待时长(分钟)",prop:"waitTime"}},[a("el-col",{attrs:{span:6}},[a("el-input",{attrs:{type:"input",placeholder:"请输入内容",clearable:""},model:{value:e.configDetail.waitTime,callback:function(t){e.$set(e.configDetail,"waitTime",t)},expression:"configDetail.waitTime"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[e.configDetail.customCheck?a("el-form-item",{attrs:{label:"自定义SQL",prop:"sqlList"}},[a("el-col",{attrs:{span:12}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:8},placeholder:"多条SQL请用',分割,结尾不要用';',查询结果是一个二维数组,如果是聚合查询,查询列必须有别名,请确保SQL语法正确,不要删除batchNo和uuid字段",clearable:""},model:{value:e.configDetail.sqlList,callback:function(t){e.$set(e.configDetail,"sqlList",t)},expression:"configDetail.sqlList"}})],1)],1):e._e(),e._v(" "),e.configDetail.customCheck?a("el-form-item",{attrs:{label:"自定义结果",prop:"valueMap"}},[a("el-col",{attrs:{span:12}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:4,maxRows:8},placeholder:'自定义期望结果是一个二维数组,格式如下[[{"nameCount":1,"avgCount":10}],[{"ageCount":2}]]',clearable:""},model:{value:e.configDetail.expectValueList,callback:function(t){e.$set(e.configDetail,"expectValueList",t)},expression:"configDetail.expectValueList"}})],1)],1):e._e()],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-form-item",{attrs:{label:"主版本",prop:"version"}},[a("el-col",{attrs:{span:6}},[a("el-input",{attrs:{type:"input",placeholder:"请输入内容",clearable:""},model:{value:e.configDetail.version,callback:function(t){e.$set(e.configDetail,"version",t)},expression:"configDetail.version"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"子版本",prop:"subVersion"}},[a("el-col",{attrs:{span:6}},[a("el-input",{attrs:{type:"input",placeholder:"请输入内容",clearable:""},model:{value:e.configDetail.subVersion,callback:function(t){e.$set(e.configDetail,"subVersion",t)},expression:"configDetail.subVersion"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"项目ID",prop:"projectId"}},[a("el-col",{attrs:{span:6}},[a("el-input",{attrs:{type:"input",placeholder:"必填项:请输入项目ID",clearable:""},model:{value:e.configDetail.projectId,callback:function(t){e.$set(e.configDetail,"projectId",t)},expression:"configDetail.projectId"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"上报日期",prop:"time"}},[a("el-col",{attrs:{span:6}},[a("el-input",{attrs:{type:"input",placeholder:"必填项:请输入上报日期",clearable:""},model:{value:e.configDetail.time,callback:function(t){e.$set(e.configDetail,"time",t)},expression:"configDetail.time"}})],1)],1)],1)],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:e.closeExecuteDialog}},[e._v("关闭")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.saveConfig}},[e._v("保存\n      ")])],1)])],1)},staticRenderFns:[]};var p=a("VU/8")(c,u,!1,function(e){a("6IxN")},"data-v-0f5cd08c",null);t.default=p.exports},"6IxN":function(e,t){},HtWW:function(e,t){}});
//# sourceMappingURL=17.694c29a1bc34830a0e65.js.map