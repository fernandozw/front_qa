webpackJsonp([8],{"/lZE":function(e,t){},"0ILO":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),s=a.n(i),l={name:"WebUiCase",components:{webUiCaseDialog:a("KJeP").a},data:function(){return{execCaseList:[],caseListDialog:!1,pageAndCaseOptions:[],ip:"http://127.0.0.1:7890/wd/hub",dialogVisibleType:1,caseId:null,dialogVisible:!1,searchForm:{id:"",caseName:"",pageId:"",pageType:"",phoneType:"",browserType:"",canUse:"",status:"",startTime:[],updateTime:[]},pageList:[],pageTypeList:[],phoneTypeList:[],browserTypeList:[],canUseList:[],canUseMap:{},statusList:[],statusMap:{},tableData:[],currentPage:1,pageSize:10,total:0}},methods:{execCases:function(){var e=this,t=String.format("{0}/case/execCaseList",this.GLOBAL.WEBUI_URL),a={caseIds:this.execCaseList.join(",")};this.axios.post(t,s()(a),{headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){return e.Message.success(t.data.msg),t}).catch(function(e){return e})},closeCaseListDialog:function(){this.caseListDialog=!1,this.execCaseList=[],this.pageAndCaseOptions=[]},openCaseListDialog:function(){var e=this;this.caseListDialog=!0;var t=String.format("{0}/case/getPageAndCase",this.GLOBAL.WEBUI_URL);this.axios.get(t).then(function(t){return e.pageAndCaseOptions=t.data.data,t}).catch(function(e){return e})},handleChange:function(e){this.fileContent=e;var t=e.name,a=t.substring(t.lastIndexOf(".")+1);if(this.fileContent)if("side"===a){var i=new FileReader;i.readAsText(e.raw,"UTF-8");var s=this;i.onload=function(e){s.insertCaseByIde(e.target.result)}}else this.$message({type:"warning",message:"文件格式错误，请重新上传！"});else this.$message({type:"warning",message:"请上传附件！"})},insertCaseByIde:function(e){var t=this,a=JSON.parse(e);a.pageId=this.searchForm.pageId;var i=String.format("{0}/case/insertCaseByIde",this.GLOBAL.WEBUI_URL);this.axios.post(i,a,{headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){return"1000"===e.data.code?(t.Message.success("导入成功!"),t.getCaseList("normal")):(t.Message.error("导入失败!"),t.getCaseList("normal")),e}).catch(function(e){return e})},tableRowClassName:function(e){e.row;return e.rowIndex%2==0?"warning-row":"success-row"},getCaseList:function(e){var t=this;"reset"===e?(this.currentPage=1,this.resetSearchForm()):"normal"===e&&(this.currentPage=1);var a=String.format("{0}/case/cases",this.GLOBAL.WEBUI_URL);this.searchForm.pageNum=this.currentPage,this.axios.post(a,s()(this.searchForm),{headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){return t.tableData=e.data.data.cases,t.total=e.data.data.total,e}).catch(function(e){return e})},callbackFunc:function(e){this.dialogVisible=!1,e&&this.getCaseList("normal")},clickAddBtn:function(){this.dialogVisibleType=1,this.dialogVisible=!0},caseDetail:function(e,t){"edit"===t?this.dialogVisibleType=2:"copy"===t&&(this.dialogVisibleType=3),this.caseId=e,this.dialogVisible=!0},deleteCase:function(e){var t=this;this.$confirm(String.format("此操作将永久删除该用例(id:{0}), 是否继续?",e),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a=String.format("{0}/case/delete",t.GLOBAL.WEBUI_URL),i={id:e};t.axios.post(a,s()(i),{headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){return"1000"===e.data.code?(t.Message.success(e.data.msg),t.getCaseList("normal")):(t.Message.error(e.data.msg),t.getCaseList("normal")),e}).catch(function(e){return e})})},getConditions:function(){var e=this,t=String.format("{0}/case/getSearchCondition",this.GLOBAL.WEBUI_URL);this.axios.get(t).then(function(t){return e.pageList=t.data.data.pageList,e.pageTypeList=t.data.data.pageTypeList,e.phoneTypeList=t.data.data.phoneTypeList,e.browserTypeList=t.data.data.browserTypeList,e.canUseList=t.data.data.canUseList,e.canUseMap=t.data.data.canUseMap,e.statusList=t.data.data.statusList,e.statusMap=t.data.data.statusMap,t}).catch(function(e){return e})},resetSearchForm:function(){this.searchForm={id:"",caseName:"",pageId:"",pageType:"",phoneType:"",browserType:"",status:"",canUse:"",startTime:[],updateTime:[]}},execCase:function(e){var t=this,a=String.format("{0}/case/execCase",this.GLOBAL.WEBUI_URL),i={id:e};this.axios.post(a,s()(i),{headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){return"1000"===e.data.code?t.Message.success(e.data.msg):t.Message.error(e.data.msg),e}).catch(function(e){return e})},debugCase:function(e){var t=this,a=String.format("{0}/config/downloadJar",this.GLOBAL.WEBUI_URL);this.$prompt("<strong><i>1、<a href="+a+">下载调试模式脚本</a></i></strong><br/><strong><i><span>2、解压脚本,并执行startNode.sh文件(sh -x startNode.sh)</span></i></strong><br/><strong><i><span>3、输入node地址(默认http://127.0.0.1:7890/wd/hub)</span></i></strong><br/><strong><i><span>4、点击执行按钮,运行case</span></i></strong>","操作步骤",{id:"debugBox",inputValue:this.ip,inputPlaceholder:"node节点的url地址:http://ip地址:端口号/wd/hub",confirmButtonText:"执行",cancelButtonText:"取消",inputPattern:/^(?:http(s)?:\/\/)?[\w.-]+(?:\.[\w\\.-]+)+[\w\-\\._~:/?#[\]@!\\$&'\\*\\+,;=.]+$/,inputErrorMessage:"url地址格式不正确",dangerouslyUseHTMLString:!0}).then(function(a){var i=a.value,l=String.format("{0}/debugCase/execCase",t.GLOBAL.WEBUI_URL),n={id:e,browserNode:i};t.axios.post(l,s()(n),{headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){return"1000"===e.data.code?t.Message.success(e.data.msg):t.Message.error(e.data.msg),e}).catch(function(e){return e})}).catch(function(e){return e})},getUserIP:function(e){var t=new(window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection)({iceServers:[]}),a=function(){},i={},s=/([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g,l=function(t){i[t]||e(t),i[t]=!0};t.createDataChannel(""),t.createOffer().then(function(e){e.sdp.split("\n").forEach(function(e){e.indexOf("candidate")<0||e.match(s).forEach(l)}),t.setLocalDescription(e,a,a)}).catch(function(e){}),t.onicecandidate=function(e){e&&e.candidate&&e.candidate.candidate&&e.candidate.candidate.match(s)&&e.candidate.candidate.match(s).forEach(l)}}},beforeMount:function(){this.getConditions(),this.getCaseList()}},n={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-form",{attrs:{inline:!0,model:e.searchForm,size:"mini"}},[a("el-form-item",{attrs:{label:"id"}},[a("el-input",{staticStyle:{width:"100px"},attrs:{placeholder:"输入id",clearable:""},model:{value:e.searchForm.id,callback:function(t){e.$set(e.searchForm,"id",t)},expression:"searchForm.id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"用例名称"}},[a("el-input",{attrs:{placeholder:"输入用例名称",clearable:""},model:{value:e.searchForm.caseName,callback:function(t){e.$set(e.searchForm,"caseName",t)},expression:"searchForm.caseName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"所属业务:"}},[a("el-select",{attrs:{placeholder:"必填项:请选择",clearable:"",filterable:""},model:{value:e.searchForm.pageId,callback:function(t){e.$set(e.searchForm,"pageId",t)},expression:"searchForm.pageId"}},e._l(e.pageList,function(e){return a("el-option",{key:e.id,attrs:{label:"「"+e.id+"」"+e.pageName,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"页面类型"}},[a("el-select",{attrs:{filterable:"",placeholder:"选择页面类型",clearable:""},model:{value:e.searchForm.pageType,callback:function(t){e.$set(e.searchForm,"pageType",t)},expression:"searchForm.pageType"}},e._l(e.pageTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"手机类型"}},[a("el-select",{attrs:{filterable:"",placeholder:"选择手机类型",clearable:""},model:{value:e.searchForm.phoneType,callback:function(t){e.$set(e.searchForm,"phoneType",t)},expression:"searchForm.phoneType"}},e._l(e.phoneTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"浏览器类型"}},[a("el-select",{attrs:{filterable:"",placeholder:"选择浏览器类型",clearable:""},model:{value:e.searchForm.browserType,callback:function(t){e.$set(e.searchForm,"browserType",t)},expression:"searchForm.browserType"}},e._l(e.browserTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"是否可用"}},[a("el-select",{attrs:{filterable:"",placeholder:"选择是否可用",clearable:""},model:{value:e.searchForm.canUse,callback:function(t){e.$set(e.searchForm,"canUse",t)},expression:"searchForm.canUse"}},e._l(e.canUseList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"运行状态"}},[a("el-select",{attrs:{filterable:"",placeholder:"选择运行状态",clearable:""},model:{value:e.searchForm.status,callback:function(t){e.$set(e.searchForm,"status",t)},expression:"searchForm.status"}},e._l(e.statusList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"创建时间"}},[a("el-date-picker",{staticStyle:{width:"360px"},attrs:{type:"datetimerange",align:"right","start-placeholder":"起始时间","end-placeholder":"截止时间","default-time":["00:00:00","23:59:59"],"value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.searchForm.startTime,callback:function(t){e.$set(e.searchForm,"startTime",t)},expression:"searchForm.startTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"更新时间"}},[a("el-date-picker",{staticStyle:{width:"360px"},attrs:{type:"datetimerange",align:"right","start-placeholder":"起始时间","end-placeholder":"截止时间","default-time":["00:00:00","23:59:59"],"value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.searchForm.updateTime,callback:function(t){e.$set(e.searchForm,"updateTime",t)},expression:"searchForm.updateTime"}})],1),e._v(" "),a("el-form-item",[a("el-upload",{staticClass:"upload-demo",attrs:{"on-change":e.handleChange,"show-file-list":!1,"auto-upload":!1,action:""}},[a("el-tooltip",{attrs:{effect:"dark",content:"用例将会与所属业务选定的业务关联,如果未选定,将会新建一个业务",placement:"top"}},[a("el-button",{staticStyle:{"margin-bottom":"15px"},attrs:{size:"mini",type:"warning"}},[e._v("导入\n          ")])],1)],1)],1),e._v(" "),a("el-form-item",[a("el-button",{staticStyle:{"margin-bottom":"15px"},attrs:{size:"mini",type:"danger"},on:{click:e.openCaseListDialog}},[e._v("执行用例集\n      ")])],1),e._v(" "),a("el-form-item",{staticStyle:{float:"right","margin-right":"60px"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.getCaseList("search")}}},[e._v("查询\n      ")]),e._v(" "),a("el-button",{attrs:{type:"success"},on:{click:e.clickAddBtn}},[e._v("新增")]),e._v(" "),a("el-button",{attrs:{type:"info"},on:{click:function(t){return e.getCaseList("reset")}}},[e._v("重置")])],1)],1),e._v(" "),e.dialogVisible?a("web-ui-case-dialog",{attrs:{visible:e.dialogVisible,"case-id":e.caseId,type:e.dialogVisibleType},on:{listenToChildEvent:e.callbackFunc}}):e._e(),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,size:"mini",border:"","cell-style":{"text-align":"center"},"header-cell-style":{"text-align":"center"},"row-class-name":e.tableRowClassName}},[a("el-table-column",{attrs:{fixed:"left",prop:"id",label:"id",width:"100","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"caseName",label:"用例名称",width:"250","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"pageId",label:"所属业务",width:"180","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v("\n          「"+e._s(e.tableData[t.$index].pageId)+"」"+e._s(e.tableData[t.$index].pageName)+"\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"pageType",label:"页面类型",width:"180","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"phoneType",label:"手机类型",width:"180","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"browserType",label:"浏览器类型",width:"180","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:"是否可用",width:"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.canUseMap[e.tableData[t.$index].canUse]))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"运行状态",width:"120","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.statusMap[e.tableData[t.$index].status]))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"addTime",label:"创建时间",width:"250","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"updateTime",label:"更新时间",width:"250","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"250",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.debugCase(e.tableData[t.$index].id)}}},[e._v("调试\n        ")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.execCase(e.tableData[t.$index].id)}}},[e._v("执行\n        ")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.caseDetail(e.tableData[t.$index].id,"edit")}}},[e._v("编辑\n        ")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.deleteCase(e.tableData[t.$index].id)}}},[e._v("删除\n        ")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.caseDetail(e.tableData[t.$index].id,"copy")}}},[e._v("复制\n        ")])]}}])})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"10px"},attrs:{"current-page":e.currentPage,"page-size":e.pageSize,layout:"total,slot, prev, pager, next, jumper",total:e.total,size:"mini"},on:{"current-change":function(t){return e.getCaseList("search")},"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}},[a("span",[e._v(e._s(e.pageSize)+"条/页")])]),e._v(" "),a("el-dialog",{attrs:{title:"执行用例集",visible:e.caseListDialog,"before-close":e.closeCaseListDialog,width:"40%"},on:{"update:visible":function(t){e.caseListDialog=t}}},[a("div",[a("el-select",{staticStyle:{width:"500px"},attrs:{size:"mini",placeholder:"请选择用例",multiple:"",filterable:""},model:{value:e.execCaseList,callback:function(t){e.execCaseList=t},expression:"execCaseList"}},e._l(e.pageAndCaseOptions,function(t){return a("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.options,function(e){return a("el-option",{key:e.value,attrs:{label:"「"+e.value+"」"+e.label,value:e.value}})}),1)}),1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini"},on:{click:e.closeCaseListDialog}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini",disabled:e.execCaseList.length<1},on:{click:e.execCases}},[e._v("执 行")])],1)])],1)},staticRenderFns:[]};var o=a("VU/8")(l,n,!1,function(e){a("L8Ev")},"data-v-1df102a7",null);t.default=o.exports},KJeP:function(e,t,a){"use strict";var i=a("mvHQ"),s=a.n(i),l=a("6Bmd"),n=a("Xxa5"),o=a.n(n),r=a("exGp"),c=a.n(r),p=a("//Fk"),u=a.n(p),d=function(e){return new u.a(function(t){var a=new Image;a.setAttribute("crossOrigin","anonymous"),a.src=e,a.onload=function(){t(function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height);var a=e.src.substring(e.src.lastIndexOf(".")+1).toLowerCase();return"jpg"===a&&(a="jpeg"),t.toDataURL("image/"+a)}(a))}})},m={name:"ExpectImageDialog",props:{expectImage:{type:Boolean,default:!1},stepId:{type:Number,default:null},compareType:{type:String,default:null}},data:function(){return{dialogImage:null,fileList:[],showImageDialog:!1,dialogVisible:!1,imageDetail:{stepId:null,completeImage:null,partImage:null},imageNum:1}},methods:{close:function(){this.$emit("listenToChildEvent",!1)},beforeAvatarUpload:function(e,t){e.size/1024/1024<10?this.fileList=t:this.$message.error("单张图片大小不能超过 10MB!")},previewImage:function(e){this.dialogImage=e.url,this.showImageDialog=!0},masterFileMax:function(e,t){this.$message.warning("请最多上传 "+this.imageNum+" 个文件。")},uploadImage:function(e){var t=this,a=String.format("{0}/expectImage/setExpectImage",this.GLOBAL.WEBUI_URL);this.axios.post(a,s()({imageDetail:this.imageDetail,compareType:this.compareType}),{headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(e){return"1000"===e.data.code?(t.close(),t.Message.success(e.data.msg)):t.Message.error(e.data.msg),e}).catch(function(e){return e})},saveImage:function(){var e=this;return c()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("assertCompleteImage"!==e.compareType){t.next=14;break}if(!(e.fileList.length<1)){t.next=5;break}e.$message.warning("请上传完整对比的图片!"),t.next=12;break;case 5:return t.t0=e.stepId,t.next=8,d(e.fileList[0].url);case 8:return t.t1=t.sent,e.imageDetail={stepId:t.t0,completeImage:t.t1,partImage:null},t.next=12,e.uploadImage(e.imageDetail);case 12:t.next=42;break;case 14:if("assertPartialImage"!==e.compareType){t.next=28;break}if(!(e.fileList.length<1)){t.next=19;break}e.$message.warning("请上传局部对比的图片!"),t.next=26;break;case 19:return t.t2=e.stepId,t.next=22,d(e.fileList[0].url);case 22:return t.t3=t.sent,e.imageDetail={stepId:t.t2,completeImage:null,partImage:t.t3},t.next=26,e.uploadImage(e.imageDetail);case 26:t.next=42;break;case 28:if("assertCompleteOrPartialImage"!==e.compareType){t.next=42;break}if(!(e.fileList.length<2)){t.next=33;break}e.$message.warning("请上传局部对比和完整对比的图片!"),t.next=42;break;case 33:return t.t4=e.stepId,t.next=36,d(e.fileList[1].url);case 36:return t.t5=t.sent,t.next=39,d(e.fileList[0].url);case 39:t.t6=t.sent,e.imageDetail={stepId:t.t4,completeImage:t.t5,partImage:t.t6},e.uploadImage(e.imageDetail);case 42:case"end":return t.stop()}},t,e)}))()},removeImage:function(e,t){this.fileList=t},checkLimit:function(){var e=this.imageNum,t=this.$refs.upload;this.fileList.length===e?t.$children[1].$el.style.display="none":t.$children[1].$el.style.display=""},base64ImgToFile:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"file",a=e.split(","),i=a[0].match(/:(.*?);/)[1],s=i.split("/")[1],l=atob(a[1]),n=l.length,o=new Uint8Array(n);n--;)o[n]=l.charCodeAt(n);return new File([o],t+"."+s,{type:i})}},watch:{fileList:{handler:function(){this.checkLimit()}}},created:function(){this.dialogVisible=this.expectImage,"assertCompleteImage"===this.compareType||"assertPartialImage"===this.compareType?this.imageNum=1:"assertCompleteOrPartialImage"===this.compareType&&(this.imageNum=2)}},g={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"image-dialog",attrs:{title:"",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close}},[a("div",{attrs:{slot:"title"},slot:"title"},[a("el-button",{attrs:{type:"text",size:"small"}},[e._v("设置图片("+e._s(e.compareType)+")\n      ")])],1),e._v(" "),a("el-upload",{ref:"upload",attrs:{action:"","auto-upload":!1,limit:e.imageNum,"on-change":e.beforeAvatarUpload,"on-exceed":e.masterFileMax,"on-preview":e.previewImage,"on-remove":e.removeImage,"list-type":"picture-card",multiple:""}},[a("i",{staticClass:"el-icon-plus"}),e._v(" "),a("div",{staticClass:"form-tips",staticStyle:{"margin-top":"10px"},attrs:{slot:"tip"},slot:"tip"},[1===e.imageNum?a("el-tag",{attrs:{type:"warning"}},[e._v("单张图片大小不能超过10MB!\n        ")]):2===e.imageNum?a("el-tag",{attrs:{type:"warning"}},[e._v("局部与完整混合对比模式下需要上传2张图片，第一张为局部图片，第二张为完整图片，单张图片大小不能超过\n          10MB!\n        ")]):e._e()],1)]),e._v(" "),a("el-dialog",{staticClass:"small-big-dialog",staticStyle:{"margin-left":"0px","margin-right":"0px"},attrs:{visible:e.showImageDialog,"append-to-body":"",width:"90%"},on:{"update:visible":function(t){e.showImageDialog=t}}},[a("el-image",{staticStyle:{width:"100%"},attrs:{src:e.dialogImage}})],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"success"},on:{click:e.saveImage}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:e.close}},[e._v("关 闭")])],1)],1)],1)},staticRenderFns:[]};var h=a("VU/8")(m,g,!1,function(e){a("YOHZ")},"data-v-3521a028",null).exports,f={name:"ImageDetailDialog",props:{expectImage:{type:Boolean,default:!1},stepId:{type:Number,default:null},compareType:{type:String,default:null}},data:function(){return{disableDeleteBtn:!0,dialogImage:null,fileList:[],showImageDialog:!1,dialogVisible:!1,imageDetail:{stepId:null,completeImage:null,partImage:null},isSetImage:!1,imageNum:1}},methods:{close:function(){this.$emit("listenToChildEvent",!1)},previewImage:function(e){this.dialogImage=e.url,this.showImageDialog=!0},masterFileMax:function(e,t){this.$message.warning("请最多上传 "+this.imageNum+" 个文件。")},detail:function(){var e=this,t=String.format("{0}/expectImage/getImage?stepId={1}",this.GLOBAL.WEBUI_URL,this.stepId);this.axios.get(t).then(function(t){return null!=t.data.data&&(e.isSetImage=!0,null!==t.data.data.partImage&&e.imgToUrl(t.data.data.partImage),null!==t.data.data.completeImage&&e.imgToUrl(t.data.data.completeImage)),t}).catch(function(e){return e})},checkLimit:function(){var e=this.imageNum,t=this.$refs.upload;this.fileList.length===e?t.$children[1].$el.style.display="none":t.$children[1].$el.style.display=""},imgToUrl:function(e){var t=this.base64ImgToFile(e),a={name:"img",url:window.webkitURL.createObjectURL(t)||window.URL.createObjectURL(t)};this.fileList.push(a)},base64ImgToFile:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"file",a=e.split(","),i=a[0].match(/:(.*?);/)[1],s=i.split("/")[1],l=atob(a[1]),n=l.length,o=new Uint8Array(n);n--;)o[n]=l.charCodeAt(n);return new File([o],t+"."+s,{type:i})}},watch:{fileList:{handler:function(){this.checkLimit()}}},created:function(){this.dialogVisible=this.expectImage,"assertCompleteImage"===this.compareType||"assertPartialImage"===this.compareType?this.imageNum=1:"assertCompleteAndPartialImage"===this.compareType&&(this.imageNum=2),this.detail()}},b={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"image-dialog",attrs:{title:"",visible:e.dialogVisible,width:"40%"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close}},[a("div",{attrs:{slot:"title"},slot:"title"},[e.isSetImage?a("el-button",{attrs:{type:"success",icon:"el-icon-check",circle:"",size:"mini"}}):a("el-button",{attrs:{type:"danger",icon:"el-icon-close",circle:"",size:"mini"}}),e._v(" "),a("el-button",{attrs:{type:"text",size:"small"}},[e._v("查看图片("+e._s(e.compareType)+")")])],1),e._v(" "),a("el-upload",{ref:"upload",attrs:{disabled:e.disableDeleteBtn,action:"","auto-upload":!1,limit:e.imageNum,"on-exceed":e.masterFileMax,"on-preview":e.previewImage,"file-list":e.fileList,"list-type":"picture-card",multiple:""}},[a("i",{staticClass:"el-icon-plus"}),e._v(" "),a("div",{staticClass:"form-tips",staticStyle:{"margin-top":"10px"},attrs:{slot:"tip"},slot:"tip"},[1===e.imageNum?a("el-tag",{attrs:{type:"warning"}},[e._v("单张图片大小不能超过10MB!\n        ")]):2===e.imageNum?a("el-tag",{attrs:{type:"warning"}},[e._v("局部与完整混合对比模式下需要上传2张图片，第一张为局部图片，第二张为完整图片，单张图片大小不能超过\n          10MB!\n        ")]):e._e()],1)]),e._v(" "),a("el-dialog",{staticClass:"small-big-dialog",staticStyle:{"margin-left":"0px","margin-right":"0px"},attrs:{visible:e.showImageDialog,"append-to-body":"",width:"90%"},on:{"update:visible":function(t){e.showImageDialog=t}}},[a("el-image",{staticStyle:{width:"100%"},attrs:{src:e.dialogImage}})],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"mini",type:"info"},on:{click:e.close}},[e._v("关 闭")])],1)],1)],1)},staticRenderFns:[]};var v=a("VU/8")(f,b,!1,function(e){a("UzBv")},"data-v-18b54c76",null).exports,y={name:"WebUiCaseDialog",components:{noticeDialog:l.a,expectImageDialog:h,imageDetailDialog:v},props:{caseId:{type:Number,default:null},type:{type:Number,default:1},visible:{type:Boolean,default:!0}},data:function(){return{imageStepId:null,compareType:"",imageList:["assertCompleteOrPartialImage","assertCompleteImage","assertPartialImage"],stepList:[{id:"",pageId:"",action:"",stepName:"",actionValue:"",function:"",status:"",verifyAction:"",verifyValue:"",paramKey:""}],actionList:[],actionParamMap:{},pageList:[],verifyList:[],statusList:[],dialogVisible:!0,noticeVisible:!1,imageVisible:!1,imageDetailVisible:!1,caseDetail:{caseName:"",pageId:"",pageType:"",phoneType:"",browserType:"",canUse:"",stepIds:""},pageTypeList:[],phoneTypeList:[],browserTypeList:[],pageVerifyList:[],canUseList:[],stepSelect:[],verifyMap:{}}},watch:{"caseDetail.pageType":{handler:function(e,t){"pc_web"===e&&e!==t&&(this.caseDetail.phoneType="")},deep:!0}},methods:{clickNotice:function(){this.noticeVisible=!0},clickImage:function(e,t){this.imageVisible=!0,this.imageStepId=e,this.compareType=t},clickImageDetail:function(e,t){this.imageDetailVisible=!0,this.imageStepId=e,this.compareType=t},callbackFunc:function(){this.noticeVisible=!1},callbackFuncForImage:function(){this.imageVisible=!1},callbackFuncForImageDetail:function(){this.imageDetailVisible=!1},changeForVerifyAction:function(e){this.stepList[e].verifyValue=""},changeforStep:function(e,t){var a=this,i=String.format("{0}/step/getStepDetailById?id={1}",this.GLOBAL.WEBUI_URL,e);this.axios.get(i).then(function(e){return a.stepList.splice(t,1,e.data.data.step),e}).catch(function(e){return e})},focusforStep:function(e){var t=this;this.stepSelect=[];var a=String.format("{0}/step/getStepListByPageId?pageId={1}",this.GLOBAL.WEBUI_URL,e);this.axios.get(a).then(function(e){return t.stepSelect=e.data.data,e}).catch(function(e){return e})},changeforPageId:function(e,t){var a=this;this.stepList[t]={id:"",pageId:e,action:"",stepName:"",actionValue:"",function:"",status:"",verifyAction:"",verifyValue:"",paramKey:""};var i=String.format("{0}/step/getStepListByPageId?pageId={1}",this.GLOBAL.WEBUI_URL,e);this.axios.get(i).then(function(e){return a.stepSelect=e.data.data,e}).catch(function(e){return e})},allStep:function(){var e=this,t=String.format("{0}/step/getAllStep",this.GLOBAL.WEBUI_URL);this.axios.get(t).then(function(t){return e.stepSelect=t.data.data,t}).catch(function(e){return e})},saveCase:function(){var e=this,t=String.format(2===this.type?"{0}/case/update":"{0}/case/add",this.GLOBAL.WEBUI_URL),a=this.stepList.map(function(e,t){return e.id}).join(",");this.caseDetail.stepIds=a;var i={uiCase:this.caseDetail,stepList:this.stepList};this.axios.post(t,s()(i),{headers:{"Content-Type":"application/json;charset=UTF-8"}}).then(function(t){return"1000"===t.data.code?(e.Message.success(t.data.msg),e.$emit("listenToChildEvent",!0)):e.Message.error(t.data.msg),t}).catch(function(e){return e})},close:function(){this.$emit("listenToChildEvent",!1)},getStepConditions:function(){var e=this,t=String.format("{0}/step/getSearchCondition",this.GLOBAL.WEBUI_URL);this.axios.get(t).then(function(t){return e.actionList=t.data.data.actionList,e.actionParamMap=t.data.data.actionParamMap,e.pageList=t.data.data.pageList,e.statusList=t.data.data.statusList,e.verifyList=t.data.data.verifyList,e.verifyMap=t.data.data.verifyMap,t}).catch(function(e){return e})},getConditions:function(){var e=this,t=String.format("{0}/case/getSearchCondition",this.GLOBAL.WEBUI_URL);this.axios.get(t).then(function(t){return e.pageList=t.data.data.pageList,e.pageTypeList=t.data.data.pageTypeList,e.phoneTypeList=t.data.data.phoneTypeList,e.browserTypeList=t.data.data.browserTypeList,e.canUseList=t.data.data.canUseList,e.pageVerifyList=t.data.data.pageVerifyList,t}).catch(function(e){return e})},detail:function(){var e=this,t=String.format("{0}/case/getCaseById?id={1}",this.GLOBAL.WEBUI_URL,this.caseId);this.axios.get(t).then(function(t){return e.caseDetail=t.data.data.caseDetail,e.stepList=t.data.data.stepList.length>0?t.data.data.stepList:[{id:"",pageId:"",action:"",stepName:"",actionValue:"",function:"",status:"",verifyAction:"",verifyValue:""}],e.getConditions(),t}).catch(function(e){return e})},handleAdd:function(e){this.stepList.splice(e,0,{pageId:"",action:"",stepName:""});var t=this.stepList[e+1];this.$set(this.stepList,e+1,this.stepList[e]),this.$set(this.stepList,e,t)},handleDelete:function(e){0===e&&1===this.stepList.length?this.stepList=[{id:"",pageId:"",action:"",stepName:"",actionValue:"",function:"",status:"",verifyAction:"",verifyValue:""}]:this.stepList.splice(e,1)}},computed:{dialogTitle:function(){return 2===this.type?"编辑（用例ID："+this.caseId+"）":3===this.type?"复制":"新增"},btnText:function(){return 3===this.type?"复 制":"保 存"},typeText:function(){return 2===this.type?"编辑":3===this.type?"复制":"新增"}},created:function(){this.dialogVisible=this.visible,1===this.type?(this.getConditions(),this.getStepConditions()):2!==this.type&&3!==this.type||(this.detail(),this.getStepConditions(),this.allStep())}},L={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"uiCase-dialog",attrs:{title:e.dialogTitle,visible:e.dialogVisible,width:"98%"},on:{"update:visible":function(t){e.dialogVisible=t},close:e.close}},[a("div",[a("el-card",{staticClass:"box-card",attrs:{id:"uiCaseBase"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("strong",[e._v("基础信息 ")])]),e._v(" "),a("el-form",{attrs:{inline:!0,model:e.caseDetail,size:"mini"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"用例名称:"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"必填项:请输入内容",clearable:""},model:{value:e.caseDetail.caseName,callback:function(t){e.$set(e.caseDetail,"caseName",t)},expression:"caseDetail.caseName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"页面类型:"}},[a("el-select",{attrs:{filterable:"",placeholder:"选择页面类型",clearable:""},model:{value:e.caseDetail.pageType,callback:function(t){e.$set(e.caseDetail,"pageType",t)},expression:"caseDetail.pageType"}},e._l(e.pageTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},["h5"===e.caseDetail.pageType?a("el-form-item",{attrs:{label:"手机类型:"}},[a("el-select",{attrs:{filterable:"",placeholder:"选择手机类型",clearable:""},model:{value:e.caseDetail.phoneType,callback:function(t){e.$set(e.caseDetail,"phoneType",t)},expression:"caseDetail.phoneType"}},e._l(e.phoneTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1):e._e()],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"浏览器类型:"}},[a("el-select",{attrs:{filterable:"",placeholder:"选择浏览器类型",clearable:""},model:{value:e.caseDetail.browserType,callback:function(t){e.$set(e.caseDetail,"browserType",t)},expression:"caseDetail.browserType"}},e._l(e.browserTypeList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"状态:"}},[a("el-select",{attrs:{filterable:"",placeholder:"选择状态",clearable:""},model:{value:e.caseDetail.canUse,callback:function(t){e.$set(e.caseDetail,"canUse",t)},expression:"caseDetail.canUse"}},e._l(e.canUseList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"所属业务:"}},[a("el-select",{attrs:{placeholder:"必填项:请选择",clearable:"",filterable:""},model:{value:e.caseDetail.pageId,callback:function(t){e.$set(e.caseDetail,"pageId",t)},expression:"caseDetail.pageId"}},e._l(e.pageList,function(e){return a("el-option",{key:e.id,attrs:{label:"「"+e.id+"」"+e.pageName,value:e.id}})}),1)],1)],1)],1)],1)],1),e._v(" "),a("el-card",{staticClass:"box-card"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("strong",[e._v("步骤信息")]),e._v(" "),a("el-button",{staticStyle:{float:"right"},attrs:{type:"text",size:"mini"},on:{click:e.clickNotice}},[e._v("内置参数说明\n          ")])],1),e._v(" "),a("el-table",{staticStyle:{width:"98%"},attrs:{data:e.stepList,border:"",stripe:"",size:"mini"}},[a("el-table-column",{attrs:{label:"所属业务",align:"center",width:"210px",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:"必填项:请选择",clearable:"",filterable:""},on:{change:function(a){return e.changeforPageId(e.stepList[t.$index].pageId,t.$index)}},model:{value:e.stepList[t.$index].pageId,callback:function(a){e.$set(e.stepList[t.$index],"pageId",a)},expression:"stepList[scope.$index].pageId"}},e._l(e.pageList,function(e){return a("el-option",{key:e.id,attrs:{label:"「"+e.id+"」"+e.pageName,value:e.id}})}),1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"步骤名称",align:"center",width:"240px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticStyle:{width:"210px"},attrs:{placeholder:"必填项:请选择",clearable:"",filterable:""},on:{change:function(a){return e.changeforStep(e.stepList[t.$index].id,t.$index)},focus:function(a){return e.focusforStep(e.stepList[t.$index].pageId)}},model:{value:e.stepList[t.$index].id,callback:function(a){e.$set(e.stepList[t.$index],"id",a)},expression:"stepList[scope.$index].id"}},e._l(e.stepSelect,function(e){return a("el-option",{key:e.id,attrs:{label:"「"+e.id+"」"+e.stepName,value:e.id}})}),1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.stepList[t.$index].action,callback:function(a){e.$set(e.stepList[t.$index],"action",a)},expression:"stepList[scope.$index].action"}},e._l(e.actionList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.label))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.value))])])}),1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作值",align:"center",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:"输入操作值",clearable:""},model:{value:e.stepList[t.$index].actionValue,callback:function(a){e.$set(e.stepList[t.$index],"actionValue",a)},expression:"stepList[scope.$index].actionValue"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"校验类型",align:"center",width:"180px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticStyle:{width:"150px"},attrs:{placeholder:"请选择",clearable:"",filterable:""},on:{change:function(a){return e.changeForVerifyAction(t.$index)}},model:{value:e.stepList[t.$index].verifyAction,callback:function(a){e.$set(e.stepList[t.$index],"verifyAction",a)},expression:"stepList[scope.$index].verifyAction"}},e._l(e.verifyList,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.label))]),e._v(" "),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.value))])])}),1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"校验值",align:"center",width:"200px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.imageList.indexOf(e.stepList[t.$index].verifyAction)>-1?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.clickImage(e.stepList[t.$index].id,e.stepList[t.$index].verifyAction)}}},[e._v("设置图片")]):e._e(),e._v(" "),e.imageList.indexOf(e.stepList[t.$index].verifyAction)>-1?a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.clickImageDetail(e.stepList[t.$index].id,e.stepList[t.$index].verifyAction)}}},[e._v("查看图片")]):a("el-input",{attrs:{placeholder:"输入校验值",clearable:"",disabled:!e.verifyMap[e.stepList[t.$index].verifyAction]},model:{value:e.stepList[t.$index].verifyValue,callback:function(a){e.$set(e.stepList[t.$index],"verifyValue",a)},expression:"stepList[scope.$index].verifyValue"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"外部函数",align:"center",width:"250PX"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:"输入外部函数",clearable:""},model:{value:e.stepList[t.$index].function,callback:function(a){e.$set(e.stepList[t.$index],"function",a)},expression:"stepList[scope.$index].function"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"状态",align:"center",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:"请选择",clearable:"",filterable:""},model:{value:e.stepList[t.$index].status,callback:function(a){e.$set(e.stepList[t.$index],"status",a)},expression:"stepList[scope.$index].status"}},e._l(e.statusList,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"保存参数",align:"center",width:"200PX"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{placeholder:"输入保存参数的key",clearable:"",disabled:"sendKeys"!==e.stepList[t.$index].action},model:{value:e.stepList[t.$index].paramKey,callback:function(a){e.$set(e.stepList[t.$index],"paramKey",a)},expression:"stepList[scope.$index].paramKey"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center",fixed:"right",width:"250px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){return e.handleAdd(t.$index)}}},[e._v("插入\n              ")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除\n              ")])]}}])})],1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.saveCase}},[e._v("保 存\n      ")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"info"},on:{click:e.close}},[e._v("关 闭")])],1)]),e._v(" "),e.noticeVisible?a("notice-dialog",{attrs:{notice:e.noticeVisible},on:{listenToChildEvent:e.callbackFunc}}):e._e(),e._v(" "),e.imageVisible?a("expect-image-dialog",{attrs:{expectImage:e.imageVisible,stepId:e.imageStepId,compareType:e.compareType},on:{listenToChildEvent:e.callbackFuncForImage}}):e._e(),e._v(" "),e.imageDetailVisible?a("image-detail-dialog",{attrs:{expectImage:e.imageDetailVisible,stepId:e.imageStepId,compareType:e.compareType},on:{listenToChildEvent:e.callbackFuncForImageDetail}}):e._e()],1)},staticRenderFns:[]};var x=a("VU/8")(y,L,!1,function(e){a("/lZE")},"data-v-131da27c",null);t.a=x.exports},L8Ev:function(e,t){},UzBv:function(e,t){},YOHZ:function(e,t){}});
//# sourceMappingURL=8.287b761d2720e1ecd260.js.map